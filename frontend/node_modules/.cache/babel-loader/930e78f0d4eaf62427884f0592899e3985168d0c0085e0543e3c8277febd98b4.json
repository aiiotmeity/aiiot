{"ast":null,"code":"import React,{useState}from'react';import{useNavigate}from'react-router-dom';import'./css/Login.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Login(){const[phoneNumber,setPhoneNumber]=useState('');const[otp,setOtp]=useState('');const[showOTP,setShowOTP]=useState(false);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[success,setSuccess]=useState('');const navigate=useNavigate();// Safe API URL\nconst API_BASE_URL='http://localhost:8000';console.log('Login component loaded');// Simple particles without complex animations\nconst createParticles=()=>{const particles=[];for(let i=0;i<20;i++){particles.push(/*#__PURE__*/_jsx(\"div\",{className:\"particle\",style:{left:Math.random()*100+'%',top:Math.random()*100+'%',width:'4px',height:'4px',backgroundColor:'rgba(255,255,255,0.3)',borderRadius:'50%',position:'absolute',animationDelay:Math.random()*5+'s'}},i));}return particles;};// Clear messages\nconst clearMessages=()=>{setError('');setSuccess('');};// Validate phone number - handles +91 prefix (13 characters total)\nconst validatePhoneNumber=phone=>{// Remove all non-digit characters except +\nconst cleanPhone=phone.replace(/[^\\d+]/g,'');// Check if it's a valid +91 format (13 characters: +91xxxxxxxxxx)\nif(cleanPhone.length===13&&cleanPhone.startsWith('+91')){const numberPart=cleanPhone.substring(3);// Remove +91\n// Check if the remaining 10 digits start with 6, 7, 8, or 9\nif(numberPart.length===10&&numberPart.match(/^[6-9]/)){return cleanPhone;// Return full +91xxxxxxxxxx format\n}}return null;};// Handle phone number input - enforce +91 prefix\nconst handlePhoneNumberChange=e=>{let value=e.target.value;// Remove all non-digit characters except +\nvalue=value.replace(/[^\\d+]/g,'');// If user starts typing without +91, auto-add it\nif(value.length>0&&!value.startsWith('+91')){// If user typed only digits, prepend +91\nif(value.match(/^\\d/)){value='+91'+value;}}// Ensure it starts with +91\nif(!value.startsWith('+91')&&value.length>0){value='+91';}// Limit to exactly 13 characters (+91 + 10 digits)\nif(value.length>13){value=value.substring(0,13);}setPhoneNumber(value);clearMessages();};// Handle OTP input\nconst handleOTPChange=e=>{const value=e.target.value.replace(/\\D/g,'').slice(0,6);setOtp(value);clearMessages();};// Handle sending OTP\nconst handleSendOTP=async e=>{e.preventDefault();console.log('Send OTP clicked');if(loading)return;setLoading(true);clearMessages();try{const validatedPhone=validatePhoneNumber(phoneNumber);if(!validatedPhone){setError('Please enter a valid phone number with +91 prefix (e.g., +919876543210)');setLoading(false);return;}console.log('Sending OTP to:',validatedPhone);// This will be +919876543210 format\nconst response=await fetch(`${API_BASE_URL}/api/send-otp/`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({phone_number:validatedPhone})});const data=await response.json();console.log('Send OTP Response:',data);if(response.ok&&data.success){setShowOTP(true);setSuccess('OTP sent successfully! Check your phone.');setPhoneNumber(validatedPhone);// Keep the +91 format\n}else{setError(data.error||data.message||'Failed to send OTP');}}catch(err){console.error('Send OTP Error:',err);setError('Network error. Please try again.');}finally{setLoading(false);}};// Handle OTP verification - FIXED VERSION\nconst handleVerifyOTP=async e=>{e.preventDefault();console.log('Verify OTP clicked');if(loading)return;setLoading(true);clearMessages();try{if(!otp||otp.length!==6){setError('Please enter a valid 6-digit OTP');setLoading(false);return;}console.log('Verifying OTP:',otp,'for phone:',phoneNumber);const response=await fetch(`${API_BASE_URL}/api/verify-otp/`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({otp_code:otp,phone_number:phoneNumber})});const data=await response.json();console.log('Verify OTP Response:',data);if(response.ok&&data.success){// Store user data in localStorage\nlocalStorage.setItem('user',JSON.stringify(data.user));localStorage.setItem('isLoggedIn','true');localStorage.setItem('loginTime',Date.now().toString());setSuccess('Login successful! Redirecting...');// FIXED: Use the redirect_to from backend response\nsetTimeout(()=>{console.log('Backend redirect_to:',data.redirect_to);console.log('User has health assessment:',data.user.has_health_assessment);console.log('Debug info:',data.debug_info);// Use React Router navigate with the exact path from backend\nif(data.redirect_to==='/health-assessment'){console.log('Navigating to health assessment');navigate('/health-assessment');}else if(data.redirect_to==='/dashboard'){console.log('Navigating to dashboard');navigate('/dashboard');}else{// Fallback logic based on has_health_assessment\nif(data.user.has_health_assessment){console.log('Fallback: Navigating to dashboard');navigate('/dashboard');}else{console.log('Fallback: Navigating to health assessment');navigate('/health-assessment');}}},1500);}else{console.log('OTP verification failed:',data);setError(data.error||data.message||'Invalid OTP');}}catch(err){console.error('Verify OTP Error:',err);setError('Network error. Please try again.');}finally{setLoading(false);}};// Handle back to phone\nconst handleBackToPhone=()=>{setShowOTP(false);setOtp('');clearMessages();};return/*#__PURE__*/_jsxs(\"div\",{className:\"login-page\",children:[/*#__PURE__*/_jsx(\"nav\",{className:\"navbar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"navbar-content\",children:/*#__PURE__*/_jsxs(\"a\",{href:\"/\",className:\"navbar-brand\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/aqi.webp\",alt:\"AQM Logo\"}),\"AirAware\"]})})}),/*#__PURE__*/_jsxs(\"section\",{className:\"login-section\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"particles\",children:createParticles()}),/*#__PURE__*/_jsxs(\"div\",{className:\"login-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"login-header\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83D\\uDC64 \",showOTP?'Verify OTP':'Login']}),/*#__PURE__*/_jsx(\"p\",{children:showOTP?`Enter the 6-digit OTP sent to ${phoneNumber}`:'Welcome back! Please log in to your account.'})]}),success&&/*#__PURE__*/_jsxs(\"div\",{className:\"success-message\",style:{backgroundColor:'#d4edda',color:'#155724',padding:'12px',borderRadius:'4px',marginBottom:'16px',border:'1px solid #c3e6cb'},children:[\"\\u2705 \",success]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",style:{backgroundColor:'#f8d7da',color:'#721c24',padding:'12px',borderRadius:'4px',marginBottom:'16px',border:'1px solid #f5c6cb'},children:[\"\\u26A0\\uFE0F \",error]}),!showOTP?/*#__PURE__*/// Phone Number Form\n_jsxs(\"form\",{onSubmit:handleSendOTP,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"phone_number\",children:\"Enter your phone number\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",id:\"phone_number\",value:phoneNumber,onChange:handlePhoneNumberChange,placeholder:\"+919876543210\",required:true,disabled:loading,maxLength:\"13\",style:{width:'100%',padding:'12px',fontSize:'16px',border:'1px solid #ddd',borderRadius:'4px',marginTop:'8px'}}),/*#__PURE__*/_jsx(\"small\",{style:{color:'#666',fontSize:'14px'},children:\"Enter mobile number with +91 prefix (13 characters total)\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||!phoneNumber,style:{width:'100%',padding:'12px',fontSize:'16px',backgroundColor:loading?'#ccc':'#007bff',color:'white',border:'none',borderRadius:'4px',cursor:loading?'not-allowed':'pointer',marginTop:'16px'},children:loading?'ðŸ“¤ Sending OTP...':'ðŸ“¤ Send OTP'})]}):/*#__PURE__*/// OTP Verification Form\n_jsxs(\"form\",{onSubmit:handleVerifyOTP,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"otp\",children:\"Enter OTP\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"otp\",value:otp,onChange:handleOTPChange,placeholder:\"Enter 6-digit OTP\",maxLength:\"6\",required:true,disabled:loading,style:{width:'100%',padding:'12px',fontSize:'16px',border:'1px solid #ddd',borderRadius:'4px',marginTop:'8px',textAlign:'center',letterSpacing:'2px'}}),/*#__PURE__*/_jsx(\"small\",{style:{color:'#666',fontSize:'14px'},children:\"Enter the 6-digit OTP sent to your phone\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading||otp.length!==6,style:{width:'100%',padding:'12px',fontSize:'16px',backgroundColor:loading?'#ccc':'#28a745',color:'white',border:'none',borderRadius:'4px',cursor:loading?'not-allowed':'pointer',marginTop:'16px'},children:loading?'ðŸ”„ Verifying...':'âœ… Verify OTP'}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'16px',textAlign:'center'},children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:handleBackToPhone,disabled:loading,style:{padding:'8px 16px',fontSize:'14px',backgroundColor:'#6c757d',color:'white',border:'none',borderRadius:'4px',cursor:loading?'not-allowed':'pointer',marginRight:'8px'},children:\"\\u2190 Back to Phone Number\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"login-footer\",style:{marginTop:'24px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"a\",{href:\"#\",style:{color:'#007bff',textDecoration:'none'},children:\"\\uD83D\\uDD11 Forgot Password?\"})}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Don't have an account?\",/*#__PURE__*/_jsx(\"a\",{href:\"/signup\",style:{color:'#007bff',textDecoration:'none',marginLeft:'4px'},children:\"\\uD83D\\uDC64 Sign Up\"})]})]})]})]})]});}export default Login;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}