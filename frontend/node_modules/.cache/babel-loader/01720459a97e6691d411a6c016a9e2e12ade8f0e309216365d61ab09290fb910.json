{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';import{useAuth}from'../App';import'./css/AdminDashboard.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminDashboard=()=>{const{user,logout}=useAuth();const[dashboardData,setDashboardData]=useState(null);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[lastRefresh,setLastRefresh]=useState(new Date());const navigate=useNavigate();const API_BASE_URL=process.env.REACT_APP_API_URL||'http://localhost:8000';// Helper function to format timestamps\nconst formatTimestamp=timestamp=>{if(!timestamp)return'No data';try{const date=new Date(timestamp);return date.toLocaleString('en-IN',{year:'numeric',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});}catch{return timestamp;}};// Helper function to determine AQI status color\nconst getAQIStatus=aqi=>{if(!aqi)return{status:'No Data',class:'aqi-moderate'};const value=parseInt(aqi);if(value<=50)return{status:'Good',class:'aqi-good'};if(value<=100)return{status:'Moderate',class:'aqi-moderate'};if(value<=200)return{status:'Unhealthy',class:'aqi-unhealthy'};return{status:'Hazardous',class:'aqi-hazardous'};};// Helper function to check if timestamp is recent (within 1 hour)\nconst isTimestampFresh=timestamp=>{if(!timestamp)return false;try{const date=new Date(timestamp);const now=new Date();const diffMinutes=(now-date)/(1000*60);return diffMinutes<=60;}catch{return false;}};const fetchData=useCallback(async()=>{setError(null);try{const response=await fetch(`${API_BASE_URL}/api/admin/dashboard/`);if(!response.ok){throw new Error(`HTTP ${response.status}: Failed to fetch dashboard data`);}const data=await response.json();console.log('Dashboard data:',data);// Debug log\nsetDashboardData(data);setLastRefresh(new Date());}catch(err){console.error('Dashboard fetch error:',err);if(err.message.includes('Failed to fetch')){setError(`Cannot connect to server. Please ensure Django server is running on ${API_BASE_URL}`);}else{setError(err.message);}}finally{setLoading(false);}},[API_BASE_URL]);useEffect(()=>{// Check admin authentication\nconst adminUser=localStorage.getItem('admin_user');if(!adminUser){navigate('/admin/login');return;}fetchData();const interval=setInterval(fetchData,30000);// Refresh every 30 seconds\nreturn()=>clearInterval(interval);},[fetchData,navigate]);const handleLogout=()=>{localStorage.removeItem('admin_user');navigate('/admin/login');};const handleRefresh=()=>{setLoading(true);fetchData();};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"panel-loader\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Loading Command Center...\"}),/*#__PURE__*/_jsx(\"div\",{className:\"loading-pulse\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-spinner fa-spin\",style:{fontSize:'2rem',color:'#3b82f6',marginTop:'20px'}})}),/*#__PURE__*/_jsx(\"p\",{style:{marginTop:'15px',color:'#6b7280'},children:\"Fetching real-time data...\"})]});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-exclamation-triangle\"}),\" Dashboard Error\"]}),/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'20px'},children:[/*#__PURE__*/_jsxs(\"button\",{onClick:handleRefresh,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-redo\"}),\" Retry\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleLogout,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sign-out-alt\"}),\" Back to Login\"]})]})]});}if(!dashboardData){return/*#__PURE__*/_jsxs(\"div\",{className:\"panel-loader\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"No Data Available\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRefresh,children:\"Retry\"})]});}const{station_data={},users=[],health_assessments=[]}=dashboardData;return/*#__PURE__*/_jsxs(\"div\",{className:\"main-wrapper\",children:[/*#__PURE__*/_jsxs(\"aside\",{className:\"sidebar\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"sidebar-header\",children:/*#__PURE__*/_jsxs(\"h1\",{className:\"sidebar-title\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-wind\",style:{marginRight:'8px'}}),\"AQI Monitor\"]})}),/*#__PURE__*/_jsxs(\"ul\",{className:\"nav flex-column\",children:[/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"nav-link active\",href:\"#\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-tachometer-alt nav-icon\"}),/*#__PURE__*/_jsx(\"span\",{className:\"nav-text\",children:\"Dashboard\"})]})}),/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"nav-link\",href:\"#stations\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-satellite-dish nav-icon\"}),/*#__PURE__*/_jsx(\"span\",{className:\"nav-text\",children:\"Monitoring Stations\"})]})}),/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"nav-link\",href:\"#users\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-users nav-icon\"}),/*#__PURE__*/_jsx(\"span\",{className:\"nav-text\",children:\"Registered Users\"})]})}),/*#__PURE__*/_jsx(\"li\",{className:\"nav-item\",children:/*#__PURE__*/_jsxs(\"a\",{className:\"nav-link\",href:\"#assessments\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-heartbeat nav-icon\"}),/*#__PURE__*/_jsx(\"span\",{className:\"nav-text\",children:\"Health Reports\"})]})})]})]}),/*#__PURE__*/_jsxs(\"main\",{className:\"content-area\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"topbar\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"topbar-title\",children:\"Admin Command Center\"}),/*#__PURE__*/_jsxs(\"p\",{style:{color:'#6b7280',fontSize:'0.9rem',margin:'4px 0 0 0'},children:[\"Last Updated: \",formatTimestamp(lastRefresh)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"user-dropdown\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"user-avatar\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-user-shield\"})}),/*#__PURE__*/_jsx(\"span\",{className:\"user-name\",children:\"Administrator\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleRefresh,style:{marginLeft:'10px',padding:'8px 12px',background:'#3b82f6',color:'white',border:'none',borderRadius:'6px',fontSize:'0.85rem'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sync-alt\"}),\" Refresh\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleLogout,style:{marginLeft:'8px',padding:'8px 12px',background:'#dc2626',color:'white',border:'none',borderRadius:'6px',fontSize:'0.85rem'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sign-out-alt\"}),\" Logout\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"station-grid\",id:\"stations\",children:Object.entries(station_data).map(_ref=>{let[stationId,stationInfo]=_ref;const latestItem=stationInfo.latest_item||{};const aqi=stationInfo.aqi;const aqiStatus=getAQIStatus(aqi);const timestamp=latestItem.time;const isFresh=isTimestampFresh(timestamp);return/*#__PURE__*/_jsxs(\"div\",{className:\"dashboard-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card-header\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"card-title\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-broadcast-tower\",style:{marginRight:'8px',color:'#3b82f6'}}),stationId.toUpperCase().replace('-',' '),\" Station\"]}),/*#__PURE__*/_jsx(\"span\",{className:`status-badge ${latestItem.time?'status-ONLINE':'status-OFFLINE'}`,children:latestItem.time?'ONLINE':'OFFLINE'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',marginBottom:'16px'},children:[/*#__PURE__*/_jsx(\"div\",{className:`aqi-value-large ${aqiStatus.class}`,children:aqi?Math.round(aqi):'N/A'}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'0.9rem',fontWeight:'600',color:'#6b7280'},children:aqiStatus.status})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"station-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Temperature\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:latestItem.temperature?`${latestItem.temperature}°C`:'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Humidity\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:latestItem.humidity?`${latestItem.humidity}%`:'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"PM2.5\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:latestItem.pm25?`${latestItem.pm25} µg/m³`:'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"PM10\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:latestItem.pm10?`${latestItem.pm10} µg/m³`:'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"CO\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:latestItem.co?`${latestItem.co} ppm`:'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"NH3\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:latestItem.nh3?`${latestItem.nh3} ppm`:'N/A'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:`last-updated ${isFresh?'timestamp-fresh':'timestamp-stale'}`,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-clock\"}),\" Last Updated: \",formatTimestamp(timestamp)]})]})]},stationId);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"data-card\",id:\"users\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"h4\",{className:\"card-title\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-users\"}),\"Registered Users (\",users.length,\")\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body p-0\",children:users.length>0?/*#__PURE__*/_jsxs(\"table\",{className:\"data-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"User ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Full Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Phone Number\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Status\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:users.map(user=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"#\",user.id]})}),/*#__PURE__*/_jsx(\"td\",{children:user.name}),/*#__PURE__*/_jsx(\"td\",{children:user.phone_number}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"status-badge status-ONLINE\",children:\"Active\"})})]},user.id))})]}):/*#__PURE__*/_jsxs(\"div\",{style:{padding:'40px',textAlign:'center',color:'#6b7280'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-users\",style:{fontSize:'2rem',marginBottom:'16px'}}),/*#__PURE__*/_jsx(\"p\",{children:\"No registered users found\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"data-card\",id:\"assessments\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"h4\",{className:\"card-title\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-heartbeat\"}),\"Health Assessments (\",health_assessments.length,\")\"]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card-body p-0\",children:health_assessments.length>0?/*#__PURE__*/_jsxs(\"table\",{className:\"data-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Assessment ID\"}),/*#__PURE__*/_jsx(\"th\",{children:\"User Name\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Age Group\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Gender\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Health Score\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Risk Level\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:health_assessments.map(assessment=>{const score=assessment.health_score;let riskLevel='Low Risk';let scoreClass='health-score-high';if(score<40){riskLevel='High Risk';scoreClass='health-score-low';}else if(score<70){riskLevel='Medium Risk';scoreClass='health-score-medium';}return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"strong\",{children:[\"#\",assessment.id]})}),/*#__PURE__*/_jsx(\"td\",{children:assessment.user__name}),/*#__PURE__*/_jsx(\"td\",{children:assessment.age_group}),/*#__PURE__*/_jsx(\"td\",{children:assessment.gender}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"span\",{className:`health-score ${scoreClass}`,children:[score,\"/100\"]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"span\",{className:`status-badge ${scoreClass==='health-score-high'?'status-ONLINE':'status-OFFLINE'}`,children:riskLevel})})]},assessment.id);})})]}):/*#__PURE__*/_jsxs(\"div\",{style:{padding:'40px',textAlign:'center',color:'#6b7280'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-heartbeat\",style:{fontSize:'2rem',marginBottom:'16px'}}),/*#__PURE__*/_jsx(\"p\",{children:\"No health assessments found\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"data-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card-header\",children:/*#__PURE__*/_jsxs(\"h4\",{className:\"card-title\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-chart-bar\"}),\"System Overview\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"card-body\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"station-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Active Stations\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-value\",children:[Object.values(station_data).filter(station=>{var _station$latest_item;return(_station$latest_item=station.latest_item)===null||_station$latest_item===void 0?void 0:_station$latest_item.time;}).length,\"/\",Object.keys(station_data).length]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Total Users\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:users.length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Health Assessments\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:health_assessments.length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"High Risk Users\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",style:{color:'#dc2626'},children:health_assessments.filter(h=>h.health_score<40).length})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"Average AQI\"}),/*#__PURE__*/_jsx(\"div\",{className:\"detail-value\",children:Object.values(station_data).length>0?Math.round(Object.values(station_data).filter(s=>s.aqi).reduce((sum,s)=>sum+s.aqi,0)/Object.values(station_data).filter(s=>s.aqi).length)||'N/A':'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-item\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"detail-label\",children:\"System Status\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"detail-value\",style:{color:'#16a34a'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-check-circle\"}),\" Operational\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:`last-updated timestamp-fresh`,style:{marginTop:'20px',textAlign:'center'},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-sync-alt\"}),\" Dashboard refreshed: \",formatTimestamp(lastRefresh)]})]})]})]})]});};export default AdminDashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}