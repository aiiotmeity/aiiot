{"ast":null,"code":"import React,{useState,useEffect,useMemo}from'react';import{useNavigate}from'react-router-dom';import'./css/HealthAssessment.css';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function HealthAssessment(){const[currentQuestion,setCurrentQuestion]=useState(0);const[formData,setFormData]=useState({age_group:'',gender:'',respiratory_conditions:[],smoking_history:'',living_environment:[],common_symptoms:[],occupational_exposure:'',medical_history:[]});const[healthScore,setHealthScore]=useState(0);const[showResult,setShowResult]=useState(false);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const[username,setUsername]=useState('');const[saveStatus,setSaveStatus]=useState('');const navigate=useNavigate();const API_BASE_URL=process.env.REACT_APP_API_URL||'http://localhost:8000';// Get username from localStorage or session\nuseEffect(()=>{const user=JSON.parse(localStorage.getItem('user')||'{}');setUsername(user.name||'User');},[]);// Memoize particles to prevent recreation on every render\nconst particles=useMemo(()=>{const particleElements=[];for(let i=0;i<20;i++){// Reduced from 30\nparticleElements.push(/*#__PURE__*/_jsx(\"div\",{className:\"floating-particle\",style:{left:Math.random()*100+'%',top:Math.random()*100+'%',animationDelay:Math.random()*3+'s',animationDuration:Math.random()*3+2+'s'}},i));}return particleElements;},[]);const questions=[{id:'age_group',title:'What is your age group?',subtitle:'Age affects air quality sensitivity',icon:'ðŸ‘¤',color:'#3b82f6',type:'radio',options:[{value:'0-12 years',label:'0-12 years',icon:'ðŸ§’'},{value:'13-18 years',label:'13-18 years',icon:'ðŸŽ“'},{value:'19-40 years',label:'19-40 years',icon:'ðŸ‘”'},{value:'41-60 years',label:'41-60 years',icon:'ðŸ‘¨'},{value:'61 years and above',label:'61 years and above',icon:'ðŸ‘´'}]},{id:'gender',title:'What is your gender?',subtitle:'Gender can influence health risk factors',icon:'âš§ï¸',color:'#8b5cf6',type:'radio',options:[{value:'Male',label:'Male',icon:'â™‚ï¸'},{value:'Female',label:'Female',icon:'â™€ï¸'},{value:'Other',label:'Other',icon:'âš§ï¸'},{value:'Prefer not to say',label:'Prefer not to say',icon:'ðŸ¤'}]},{id:'respiratory_conditions',title:'Do you have any respiratory conditions?',subtitle:'Respiratory health affects air quality sensitivity',icon:'ðŸ«',color:'#ef4444',type:'checkbox',options:[{value:'Asthma',label:'Asthma',icon:'ðŸ’¨'},{value:'COPD',label:'COPD',icon:'ðŸ«'},{value:'Chronic Bronchitis',label:'Chronic Bronchitis',icon:'ðŸ¦ '},{value:'Emphysema',label:'Emphysema',icon:'ðŸ«'},{value:'None',label:'None of the above',icon:'âœ…'}]},{id:'smoking_history',title:'Smoking History',subtitle:'Smoking significantly impacts respiratory health',icon:'ðŸš¬',color:'#f59e0b',type:'radio',options:[{value:'Never smoked',label:'Never smoked',icon:'ðŸš«'},{value:'Former smoker',label:'Former smoker',icon:'â°'},{value:'Current smoker',label:'Current smoker',icon:'ðŸš¬'},{value:'Exposed to secondhand smoke',label:'Exposed to secondhand smoke',icon:'â˜ï¸'}]},{id:'living_environment',title:'Living Environment',subtitle:'Your environment affects daily air quality exposure',icon:'ðŸ™ï¸',color:'#10b981',type:'checkbox',options:[{value:'Urban area',label:'Urban area with heavy traffic',icon:'ðŸ™ï¸'},{value:'Industrial zone',label:'Near industrial zone',icon:'ðŸ­'},{value:'Rural area',label:'Rural area',icon:'ðŸŒ³'},{value:'Coastal area',label:'Coastal area',icon:'ðŸŒŠ'}]},{id:'common_symptoms',title:'Common Symptoms',subtitle:'Current symptoms that may be air quality related',icon:'ðŸ’“',color:'#f43f5e',type:'checkbox',options:[{value:'Frequent coughing',label:'Frequent coughing',icon:'ðŸ¤§'},{value:'Shortness of breath',label:'Shortness of breath',icon:'ðŸ˜®â€ðŸ’¨'},{value:'Wheezing',label:'Wheezing',icon:'ðŸ’¨'},{value:'Chest tightness',label:'Chest tightness',icon:'ðŸ«¸'},{value:'None',label:'None of the above',icon:'ðŸ˜Š'}]},{id:'occupational_exposure',title:'Occupational Exposure',subtitle:'Work environment affects daily exposure to pollutants',icon:'ðŸ’¼',color:'#6366f1',type:'radio',options:[{value:'Construction/Mining',label:'Construction/Mining',icon:'â›‘ï¸'},{value:'Chemical Industry',label:'Chemical Industry',icon:'ðŸ§ª'},{value:'Healthcare',label:'Healthcare',icon:'ðŸ‘©â€âš•ï¸'},{value:'Agriculture',label:'Agriculture',icon:'ðŸŒ±'},{value:'Office Environment',label:'Office Environment',icon:'ðŸ¢'},{value:'Other',label:'Other',icon:'ðŸ“‹'}]},{id:'medical_history',title:'Medical History',subtitle:'Existing conditions that may increase air quality sensitivity',icon:'ðŸ“‹',color:'#ec4899',type:'checkbox',options:[{value:'Hypertension',label:'Hypertension',icon:'ðŸ’“'},{value:'Diabetes',label:'Diabetes',icon:'ðŸ’‰'},{value:'Heart Disease',label:'Heart Disease',icon:'â¤ï¸'},{value:'Allergies',label:'Allergies',icon:'ðŸ¤§'},{value:'Immunocompromised',label:'Immunocompromised',icon:'ðŸ›¡ï¸'}]}];const handleOptionChange=function(questionId,value){let isCheckbox=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(isCheckbox){setFormData(prev=>{const currentValues=prev[questionId]||[];if(value==='None'){return{...prev,[questionId]:currentValues.includes('None')?[]:['None']};}else{const filteredValues=currentValues.filter(v=>v!=='None');if(filteredValues.includes(value)){return{...prev,[questionId]:filteredValues.filter(v=>v!==value)};}else{return{...prev,[questionId]:[...filteredValues,value]};}}});}else{setFormData(prev=>({...prev,[questionId]:value}));}};const isQuestionAnswered=questionIndex=>{const question=questions[questionIndex];const value=formData[question.id];if(question.type==='checkbox'){return Array.isArray(value)&&value.length>0;}else{return value!=='';}};const nextQuestion=()=>{if(isQuestionAnswered(currentQuestion)){if(currentQuestion<questions.length-1){setCurrentQuestion(currentQuestion+1);setError('');}}else{setError('Please select an option before proceeding');setTimeout(()=>setError(''),3000);}};const prevQuestion=()=>{if(currentQuestion>0){setCurrentQuestion(currentQuestion-1);setError('');}};const calculateHealthScore=()=>{let score=0;// Age Group scoring\nconst ageScores={\"0-12 years\":5,\"13-18 years\":8,\"19-40 years\":10,\"41-60 years\":15,\"61 years and above\":20};score+=ageScores[formData.age_group]||0;// Gender scoring\nscore+=formData.gender===\"Male\"?2:1;// Respiratory conditions\nif(formData.respiratory_conditions&&!formData.respiratory_conditions.includes(\"None\")){score+=formData.respiratory_conditions.length*3;}// Smoking history\nconst smokingScores={\"Never smoked\":0,\"Former smoker\":10,\"Current smoker\":25,\"Exposed to secondhand smoke\":8};score+=smokingScores[formData.smoking_history]||0;// Living environment\nconst environmentScores={\"Urban area\":10,\"Industrial zone\":15,\"Rural area\":3,\"Coastal area\":2};if(formData.living_environment){formData.living_environment.forEach(env=>{score+=environmentScores[env]||0;});}// Common symptoms\nconst symptomScores={\"Frequent coughing\":8,\"Shortness of breath\":10,\"Wheezing\":8,\"Chest tightness\":9};if(formData.common_symptoms){formData.common_symptoms.forEach(symptom=>{score+=symptomScores[symptom]||0;});}// Occupational exposure\nconst occupationScores={\"Construction/Mining\":15,\"Chemical Industry\":15,\"Healthcare\":8,\"Agriculture\":10,\"Office Environment\":3,\"Other\":5};score+=occupationScores[formData.occupational_exposure]||0;// Medical history\nconst conditionScores={\"Hypertension\":8,\"Diabetes\":8,\"Heart Disease\":10,\"Allergies\":5,\"Immunocompromised\":12};if(formData.medical_history){formData.medical_history.forEach(condition=>{score+=conditionScores[condition]||0;});}return score;};const getHealthStatus=score=>{if(score<=50){return{status:'Excellent Health',color:'#10b981',bgColor:'#d1fae5',message:'You are in excellent health. Keep up your healthy lifestyle!'};}else if(score<=80){return{status:'Good Health',color:'#8b5cf6',bgColor:'#ede9fe',message:'You are in good health. Continue to maintain your current lifestyle.'};}else if(score<=120){return{status:'Moderate Risk',color:'#f59e0b',bgColor:'#fef3c7',message:'Some areas need attention. Consider improving your health habits.'};}else if(score<=150){return{status:'Warning',color:'#f97316',bgColor:'#fed7aa',message:'Some areas require serious attention. We recommend consulting a healthcare professional.'};}else if(score<=200){return{status:'High Risk',color:'#ef4444',bgColor:'#fee2e2',message:'High health risks detected. Please seek immediate medical advice.'};}else{return{status:'Critical Risk',color:'#dc2626',bgColor:'#fef2f2',message:'Severe health risks detected. Immediate medical intervention is necessary.'};}};const handleSubmit=async()=>{if(!isQuestionAnswered(currentQuestion)){setError('Please answer all questions before submitting');return;}setLoading(true);setError('');setSaveStatus('Saving...');try{const score=calculateHealthScore();console.log('API_BASE_URL:',API_BASE_URL);console.log('Full API URL:',`${API_BASE_URL}/api/health-assessment/`);console.log('Sending data:',{...formData,health_score:score,username:username});const response=await fetch(`${API_BASE_URL}/api/health-assessment/`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({...formData,health_score:score,username:username})});console.log('Response status:',response.status);if(!response.ok){throw new Error(`HTTP error! status: ${response.status}`);}const data=await response.json();console.log('Response data:',data);if(data.success){setHealthScore(score);setSaveStatus('âœ… Saved successfully!');setShowResult(true);// Redirect to dashboard after 4 seconds\nsetTimeout(()=>{navigate('/dashboard');},4000);}else{setError(data.error||'Failed to save health assessment');setSaveStatus('âŒ Save failed');}}catch(err){console.error('Network error details:',err);if(err.name==='TypeError'&&err.message.includes('fetch')){setError('Cannot connect to server. Please check if the backend is running.');setSaveStatus('âŒ Connection failed');}else if(err.message.includes('HTTP error')){setError(`Server error: ${err.message}`);setSaveStatus('âŒ Server error');}else{setError('Network error. Please try again.');setSaveStatus('âŒ Network error');}}finally{setLoading(false);}};const progressPercentage=(currentQuestion+1)/questions.length*100;if(showResult){const healthStatus=getHealthStatus(healthScore);return/*#__PURE__*/_jsxs(\"div\",{className:\"health-assessment-page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"floating-particles\",children:particles}),/*#__PURE__*/_jsx(\"div\",{className:\"navbar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"navbar-content\",children:/*#__PURE__*/_jsxs(\"a\",{href:\"/\",className:\"navbar-brand\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/aqi.webp\",alt:\"AQM Logo\"}),\"AirAware\"]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"result-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"result-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"success-animation\",children:/*#__PURE__*/_jsx(\"div\",{className:\"checkmark-circle\",children:/*#__PURE__*/_jsx(\"div\",{className:\"checkmark\",children:\"\\u2713\"})})}),/*#__PURE__*/_jsx(\"h1\",{children:\"Assessment Complete!\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Hello, \",username,\"! Your health assessment has been saved successfully.\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"health-score-display\",style:{background:healthStatus.bgColor},children:[/*#__PURE__*/_jsx(\"div\",{className:\"score-circle\",style:{background:`conic-gradient(${healthStatus.color} ${healthScore/250*100}%, #e5e7eb ${healthScore/250*100}%)`},children:/*#__PURE__*/_jsxs(\"div\",{className:\"score-inner-circle\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"score-number\",children:healthScore}),/*#__PURE__*/_jsx(\"div\",{className:\"score-label\",children:\"Health Score\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"health-status-info\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Your Health Score: \",healthScore]}),/*#__PURE__*/_jsx(\"div\",{className:\"health-status\",style:{color:healthStatus.color},children:healthStatus.status}),/*#__PURE__*/_jsx(\"p\",{className:\"health-message\",children:healthStatus.message})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"save-status\",children:saveStatus}),/*#__PURE__*/_jsxs(\"div\",{className:\"redirect-message\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"countdown-circle\",children:\"\\u23F0\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Redirecting to your dashboard in 4 seconds...\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"action-buttons\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/dashboard'),className:\"btn-primary\",style:{padding:'12px 24px',backgroundColor:'#007bff',color:'white',border:'none',borderRadius:'8px',cursor:'pointer',fontSize:'16px',display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCCA\"}),\"Go to Dashboard Now\"]})})]})})]});}const currentQuestionData=questions[currentQuestion];return/*#__PURE__*/_jsxs(\"div\",{className:\"health-assessment-page\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"floating-particles\",children:particles}),/*#__PURE__*/_jsx(\"div\",{className:\"navbar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"navbar-content\",children:/*#__PURE__*/_jsxs(\"a\",{href:\"/\",className:\"navbar-brand\",children:[/*#__PURE__*/_jsx(\"img\",{src:\"/aqi.webp\",alt:\"AQM Logo\"}),\"AirAware\"]})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-icon\",children:\"\\uD83D\\uDCCB\"}),/*#__PURE__*/_jsx(\"h1\",{children:\"Health Assessment Questionnaire\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Hello, \",username,\"! Let's evaluate your health status for personalized air quality recommendations.\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"back-button-container\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate('/dashboard'),className:\"back-button\",style:{padding:'8px 16px',backgroundColor:'#6c757d',color:'white',border:'none',borderRadius:'4px',cursor:'pointer',display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2190\"}),\"Back to Profile\"]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"progress-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"progress-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"progress-stats\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"progress-label\",children:\"Your Progress\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"progress-count\",children:[currentQuestion+1,\"/\",questions.length,\" Questions\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"progress-percentage\",children:[Math.round(progressPercentage),\"%\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"progress-bar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"progress\",style:{width:`${progressPercentage}%`,background:`linear-gradient(90deg, ${currentQuestionData.color}, ${currentQuestionData.color}aa)`}})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"question-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"question active\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"question-header\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"question-icon\",style:{background:`${currentQuestionData.color}20`,color:currentQuestionData.color},children:/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'24px'},children:currentQuestionData.icon})}),/*#__PURE__*/_jsxs(\"div\",{className:\"question-text\",children:[/*#__PURE__*/_jsx(\"h3\",{children:currentQuestionData.title}),/*#__PURE__*/_jsx(\"p\",{className:\"question-subtitle\",children:currentQuestionData.subtitle})]})]}),error&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-message\",style:{backgroundColor:'#f8d7da',color:'#721c24',padding:'12px',borderRadius:'4px',marginBottom:'16px',border:'1px solid #f5c6cb',display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u26A0\\uFE0F\"}),error]}),/*#__PURE__*/_jsx(\"div\",{className:\"options\",children:currentQuestionData.options.map((option,index)=>/*#__PURE__*/_jsxs(\"div\",{className:`${currentQuestionData.type==='checkbox'?'checkbox-option':'option'} ${currentQuestionData.type==='checkbox'?(formData[currentQuestionData.id]||[]).includes(option.value)?'selected':'':formData[currentQuestionData.id]===option.value?'selected':''}`,style:{animationDelay:`${index*0.1}s`,cursor:'pointer',padding:'16px',border:'1px solid #ddd',borderRadius:'8px',margin:'8px 0',display:'flex',alignItems:'center',gap:'12px'},onClick:()=>handleOptionChange(currentQuestionData.id,option.value,currentQuestionData.type==='checkbox'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"option-icon\",style:{fontSize:'20px'},children:option.icon}),/*#__PURE__*/_jsx(\"input\",{type:currentQuestionData.type==='checkbox'?'checkbox':'radio',id:`${currentQuestionData.id}-${option.value}`,name:currentQuestionData.id,value:option.value,checked:currentQuestionData.type==='checkbox'?(formData[currentQuestionData.id]||[]).includes(option.value):formData[currentQuestionData.id]===option.value,onChange:()=>{}// Handled by onClick\n,style:{margin:0}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:`${currentQuestionData.id}-${option.value}`,style:{flex:1,cursor:'pointer'},children:option.label}),(currentQuestionData.type==='checkbox'&&(formData[currentQuestionData.id]||[]).includes(option.value)||currentQuestionData.type!=='checkbox'&&formData[currentQuestionData.id]===option.value)&&/*#__PURE__*/_jsx(\"div\",{className:\"option-checkmark\",style:{color:'#10b981'},children:\"\\u2713\"})]},option.value))}),/*#__PURE__*/_jsxs(\"div\",{className:\"navigation\",style:{display:'flex',justifyContent:'space-between',marginTop:'24px'},children:[/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"nav-button prev-button\",onClick:prevQuestion,style:{display:currentQuestion===0?'none':'flex',padding:'12px 24px',backgroundColor:'#6c757d',color:'white',border:'none',borderRadius:'8px',cursor:'pointer',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2190\"}),\"Previous\"]}),currentQuestion<questions.length-1?/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"nav-button next-button\",onClick:nextQuestion,style:{background:currentQuestionData.color,padding:'12px 24px',color:'white',border:'none',borderRadius:'8px',cursor:'pointer',display:'flex',alignItems:'center',gap:'8px'},children:[\"Next\",/*#__PURE__*/_jsx(\"span\",{children:\"\\u2192\"})]}):/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"nav-button submit-button\",onClick:handleSubmit,disabled:loading,style:{background:loading?'#94a3b8':'#10b981',padding:'12px 24px',color:'white',border:'none',borderRadius:'8px',cursor:loading?'not-allowed':'pointer',display:'flex',alignItems:'center',gap:'8px'},children:loading?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDD04\"}),\"Submitting...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\u2705\"}),\"Submit Assessment\"]})})]})]})})]})]});}export default HealthAssessment;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}