{"ast":null,"code":"// App.js\nimport React,{useState,useEffect,createContext,useContext}from'react';import{BrowserRouter as Router,Routes,Route,Navigate}from'react-router-dom';// Import Components\nimport HomePage from'./components/HomePage';import Login from'./components/Login';import Signup from'./components/Signup';import HealthAssessment from'./components/HealthAssessment';import Dashboard from'./components/Dashboard';import MapPage from'./components/MapPage';import HealthReport from'./components/HealthReport';import FamilyPage from'./components/FamilyPage';import AdminDashboard from'./components/AdminDashboard';import AdminLogin from'./components/AdminLogin';// Session Manager\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const SessionManager={SESSION_DURATION:60*60*1000,// 1 hour\nisLoggedIn:()=>{try{const user=localStorage.getItem('user');const loginTime=localStorage.getItem('loginTime');if(!user||!loginTime)return false;const sessionAge=Date.now()-parseInt(loginTime);if(sessionAge>SessionManager.SESSION_DURATION){SessionManager.logout();return false;}return true;}catch{return false;}},getCurrentUser:()=>{if(!SessionManager.isLoggedIn())return null;try{return JSON.parse(localStorage.getItem('user'));}catch{SessionManager.logout();return null;}},login:userData=>{try{localStorage.setItem('user',JSON.stringify(userData));localStorage.setItem('loginTime',Date.now().toString());SessionManager.setAutoLogout();}catch(error){console.error('Login failed:',error);}},logout:()=>{try{localStorage.removeItem('user');localStorage.removeItem('loginTime');localStorage.removeItem('userLocation');}catch(error){console.error('Logout error:',error);}if(window.sessionTimeout)clearTimeout(window.sessionTimeout);if(window.location.pathname!=='/'){window.location.href='/';}},setAutoLogout:()=>{if(window.sessionTimeout)clearTimeout(window.sessionTimeout);window.sessionTimeout=setTimeout(()=>{alert('Session expired. Please login again.');SessionManager.logout();},SessionManager.SESSION_DURATION);}};// Auth Context\nconst AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>useContext(AuthContext);// Protected Route\nconst ProtectedRoute=_ref=>{let{children}=_ref;return SessionManager.isLoggedIn()?children:/*#__PURE__*/_jsx(Navigate,{to:\"/login\",replace:true});};// Admin Protected Route - Fixed to check for admin_user\nconst AdminProtectedRoute=_ref2=>{let{children}=_ref2;const adminUser=localStorage.getItem('admin_user');return adminUser?children:/*#__PURE__*/_jsx(Navigate,{to:\"/admin/login\",replace:true});};// Loading Screen\nconst LoadingScreen=()=>/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',justifyContent:'center',alignItems:'center',height:'100vh',backgroundColor:'#f8fafc',fontFamily:'Arial, sans-serif'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'40px',height:'40px',border:'3px solid #e5e7eb',borderTop:'3px solid #3b82f6',borderRadius:'50%',animation:'spin 1s linear infinite',marginBottom:'16px'}}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#6b7280',fontSize:'14px'},children:\"Loading AirAware...\"}),/*#__PURE__*/_jsx(\"style\",{children:`@keyframes spin {0% { transform: rotate(0deg);}100% { transform: rotate(360deg);}}`})]});function App(){const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const initializeAuth=()=>{const currentUser=SessionManager.getCurrentUser();setUser(currentUser);if(currentUser)SessionManager.setAutoLogout();setLoading(false);};const timer=setTimeout(initializeAuth,100);// Activity detection\nconst handleActivity=()=>{if(SessionManager.isLoggedIn())SessionManager.setAutoLogout();};let activityTimer;const throttledActivity=()=>{if(activityTimer)return;activityTimer=setTimeout(()=>{handleActivity();activityTimer=null;},30000);};document.addEventListener('click',throttledActivity);document.addEventListener('keydown',throttledActivity);return()=>{clearTimeout(timer);document.removeEventListener('click',throttledActivity);document.removeEventListener('keydown',throttledActivity);if(activityTimer)clearTimeout(activityTimer);};},[]);const authValue={user,login:userData=>{SessionManager.login(userData);setUser(userData);},logout:()=>{SessionManager.logout();setUser(null);},isLoggedIn:()=>SessionManager.isLoggedIn()};if(loading)return/*#__PURE__*/_jsx(LoadingScreen,{});return/*#__PURE__*/_jsx(AuthContext.Provider,{value:authValue,children:/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(HomePage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/login\",element:user?/*#__PURE__*/_jsx(Navigate,{to:\"/dashboard\",replace:true}):/*#__PURE__*/_jsx(Login,{})}),/*#__PURE__*/_jsx(Route,{path:\"/signup\",element:user?/*#__PURE__*/_jsx(Navigate,{to:\"/dashboard\",replace:true}):/*#__PURE__*/_jsx(Signup,{})}),/*#__PURE__*/_jsx(Route,{path:\"/map\",element:/*#__PURE__*/_jsx(MapPage,{})}),/*#__PURE__*/_jsx(Route,{path:\"/dashboard\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(Dashboard,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/health-assessment\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(HealthAssessment,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/health-report\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(HealthReport,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/add-family\",element:/*#__PURE__*/_jsx(ProtectedRoute,{children:/*#__PURE__*/_jsx(FamilyPage,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/login\",element:/*#__PURE__*/_jsx(AdminLogin,{})}),/*#__PURE__*/_jsx(Route,{path:\"/admin/dashboard\",element:/*#__PURE__*/_jsx(AdminProtectedRoute,{children:/*#__PURE__*/_jsx(AdminDashboard,{})})}),/*#__PURE__*/_jsx(Route,{path:\"/admin-login\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/admin/login\",replace:true})}),/*#__PURE__*/_jsx(Route,{path:\"/admin-dashboard\",element:/*#__PURE__*/_jsx(Navigate,{to:\"/admin/dashboard\",replace:true})})]})})});}export default App;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}