{"ast":null,"code":"var _jsxFileName = \"C:\\\\React\\\\my-django-react-app\\\\frontend\\\\src\\\\components\\\\MapPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport logoImage from '../assets/aqi.webp';\nimport { useAuth } from '../App';\nimport './css/MapPage.css';\n\n// --- Helper Functions ---\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst getAQIColor = aqi => {\n  if (aqi === null || aqi === undefined) return '#9ca3af'; // Gray for unknown/upcoming\n  if (aqi <= 50) return '#10b981';\n  if (aqi <= 100) return '#f59e0b';\n  if (aqi <= 200) return '#ef4444';\n  return '#7c2d12';\n};\nconst getAQIStatus = aqi => {\n  if (aqi === null || aqi === undefined) return 'Upcoming';\n  if (aqi <= 50) return 'Good';\n  if (aqi <= 100) return 'Moderate';\n  if (aqi <= 200) return 'Unhealthy';\n  return 'Hazardous';\n};\nconst calculateDistance = (lat1, lon1, lat2, lon2) => {\n  const R = 6371; // km\n  const dLat = (lat2 - lat1) * Math.PI / 180;\n  const dLon = (lon2 - lon1) * Math.PI / 180;\n  const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) ** 2;\n  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n  return R * c;\n};\nconst MapPage = () => {\n  _s();\n  // --- STATE MANAGEMENT ---\n  const [mapInstance, setMapInstance] = useState(null);\n  const [stations, setStations] = useState({});\n  const [selectedStation, setSelectedStation] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [userLocation, setUserLocation] = useState(null);\n  const [userLocationData, setUserLocationData] = useState(null);\n  const [isLocationLoading, setIsLocationLoading] = useState(false);\n  const [isMobileView, setIsMobileView] = useState(window.innerWidth <= 768);\n  const [activeView, setActiveView] = useState('user'); // 'user' or 'station'\n\n  const mapRef = useRef(null);\n  const markersRef = useRef({});\n  const userLocationMarkerRef = useRef(null);\n  const {\n    user,\n    logout\n  } = useAuth();\n  const navigate = useNavigate();\n  const API_BASE_URL = process.env.NODE_ENV === 'production' ? 'https://airaware-app-gcw7.onrender.com' : 'http://localhost:8000';\n\n  // --- HOOKS ---\n  useEffect(() => {\n    if (!user) navigate('/login');\n  }, [user, navigate]);\n  useEffect(() => {\n    const handleResize = () => setIsMobileView(window.innerWidth <= 768);\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  // CORRECTED: This effect now safely initializes the map once.\n  useEffect(() => {\n    if (mapRef.current && !mapRef.current._leaflet_id) {\n      const map = window.L.map(mapRef.current, {\n        zoomControl: false\n      }).setView([10.176, 76.430], 13);\n      window.L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        attribution: 'Â© OpenStreetMap'\n      }).addTo(map);\n      window.L.control.zoom({\n        position: 'topright'\n      }).addTo(map);\n      setMapInstance(map);\n    }\n  }, []); // Empty dependency array ensures this runs only on mount.\n\n  const calculateSmartEstimation = useCallback((locationData, allStations) => {\n    const realStationIds = ['lora-v1', 'loradev2'];\n    const realStations = {};\n    realStationIds.forEach(id => {\n      if (allStations[id]) realStations[id] = allStations[id];\n    });\n    if (Object.keys(realStations).length === 0) return {\n      aqi: 0,\n      values: {}\n    };\n    let totalWeight = 0;\n    const weightedValues = {\n      pm25: 0,\n      pm10: 0,\n      so2: 0,\n      no2: 0,\n      co: 0,\n      o3: 0,\n      nh3: 0\n    };\n    let weightedAqi = 0;\n    Object.values(realStations).forEach(station => {\n      const distance = calculateDistance(locationData.lat, locationData.lng, station.station_info.lat, station.station_info.lng);\n      const weight = 1.0 / Math.max(distance, 0.001) ** 2;\n      totalWeight += weight;\n      Object.keys(weightedValues).forEach(param => {\n        var _station$averages;\n        if (((_station$averages = station.averages) === null || _station$averages === void 0 ? void 0 : _station$averages[param]) !== undefined) weightedValues[param] += station.averages[param] * weight;\n      });\n      weightedAqi += (station.highest_sub_index || 0) * weight;\n    });\n    const estimatedValues = {};\n    Object.keys(weightedValues).forEach(param => {\n      estimatedValues[param] = totalWeight > 0 ? parseFloat((weightedValues[param] / totalWeight).toFixed(2)) : 0;\n    });\n    const estimatedAqi = totalWeight > 0 ? Math.round(weightedAqi / totalWeight) : 50;\n    return {\n      values: estimatedValues,\n      aqi: estimatedAqi\n    };\n  }, []);\n  useEffect(() => {\n    if (userLocation && Object.keys(stations).length > 0) {\n      const estimation = calculateSmartEstimation(userLocation, stations);\n      const {\n        lat,\n        lng\n      } = stations['lora-v1'].station_info;\n      const distanceToNearest = calculateDistance(userLocation.lat, userLocation.lng, lat, lng);\n      const isHighConfidence = distanceToNearest <= 5.0;\n      setUserLocationData({\n        aqi: estimation.aqi,\n        values: estimation.values,\n        quality: isHighConfidence ? 'High-Accuracy' : 'Regional Estimation'\n      });\n    }\n  }, [userLocation, stations, calculateSmartEstimation]);\n  useEffect(() => {\n    const fetchData = async () => {\n      setIsLoading(true);\n      try {\n        const response = await fetch(`${API_BASE_URL}/api/map/realtime/`);\n        if (!response.ok) throw new Error('Network response was not ok');\n        const data = await response.json();\n        setStations(data.stations);\n      } catch (err) {\n        console.error(\"Failed to fetch station data:\", err);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    fetchData();\n    const interval = setInterval(fetchData, 60000);\n    return () => clearInterval(interval);\n  }, [API_BASE_URL]);\n  useEffect(() => {\n    if (mapInstance && Object.keys(stations).length > 0) {\n      Object.values(markersRef.current).forEach(marker => marker.remove());\n      markersRef.current = {};\n      Object.entries(stations).forEach(([id, station]) => {\n        const {\n          lat,\n          lng\n        } = station.station_info;\n        const aqi = station.highest_sub_index;\n        const icon = window.L.divIcon({\n          html: `<div class=\"station-marker-icon\" style=\"background-color: ${getAQIColor(aqi)};\"></div>`,\n          className: 'station-marker',\n          iconSize: [24, 24],\n          iconAnchor: [12, 12]\n        });\n        const marker = window.L.marker([lat, lng], {\n          icon\n        }).addTo(mapInstance);\n        marker.on('click', () => {\n          if (station.averages) {\n            setSelectedStation(station);\n            setActiveView('station');\n          } else {\n            const popupContent = `\n                            <div class=\"upcoming-popup\">\n                                <h4>${station.station_info.name}</h4>\n                                <p>This station is coming soon.</p>\n                                <span>Data Update Soon...</span>\n                            </div>\n                        `;\n            marker.bindPopup(popupContent).openPopup();\n          }\n        });\n        markersRef.current[id] = marker;\n      });\n    }\n  }, [mapInstance, stations]);\n  useEffect(() => {\n    if (mapInstance && userLocation) {\n      const userIcon = window.L.divIcon({\n        html: `<div class=\"user-location-marker\"></div>`,\n        className: 'user-marker',\n        iconSize: [24, 24],\n        iconAnchor: [12, 12]\n      });\n      if (userLocationMarkerRef.current) {\n        userLocationMarkerRef.current.setLatLng(userLocation);\n      } else {\n        userLocationMarkerRef.current = window.L.marker(userLocation, {\n          icon: userIcon\n        }).addTo(mapInstance);\n      }\n    }\n  }, [mapInstance, userLocation]);\n  const trackUserLocation = useCallback(() => {\n    setIsLocationLoading(true);\n    setActiveView('user');\n    navigator.geolocation.getCurrentPosition(position => {\n      const loc = {\n        lat: position.coords.latitude,\n        lng: position.coords.longitude\n      };\n      setUserLocation(loc);\n      setIsLocationLoading(false);\n      if (mapInstance) mapInstance.setView(loc, 15);\n    }, () => {\n      setIsLocationLoading(false);\n    });\n  }, [mapInstance]);\n  const renderPanelContent = () => {\n    if (activeView === 'station' && selectedStation) {\n      const data = selectedStation;\n      return /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"panel-header\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: data.station_info.name\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 210,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"back-btn\",\n            onClick: () => setActiveView('user'),\n            children: \"\\u2190 Back to Your Location\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"aqi-display\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"aqi-value\",\n            style: {\n              color: getAQIColor(data.highest_sub_index)\n            },\n            children: Math.round(data.highest_sub_index)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 214,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"aqi-status\",\n            children: getAQIStatus(data.highest_sub_index)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 217,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"readings-grid\",\n          children: ['pm25', 'pm10', 'no2', 'so2', 'o3', 'co'].map(key => {\n            var _data$averages, _data$averages$key;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"reading-item\",\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"reading-label\",\n                children: key.toUpperCase()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 222,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"reading-value\",\n                children: ((_data$averages = data.averages) === null || _data$averages === void 0 ? void 0 : (_data$averages$key = _data$averages[key]) === null || _data$averages$key === void 0 ? void 0 : _data$averages$key.toFixed(1)) || 'N/A'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 223,\n                columnNumber: 33\n              }, this)]\n            }, key, true, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 30\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true);\n    }\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"panel-header\",\n        children: /*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Your Location's Air Quality\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 17\n      }, this), userLocationData ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"aqi-display\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"aqi-quality-badge\",\n            children: userLocationData.quality\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"aqi-value\",\n            style: {\n              color: getAQIColor(userLocationData.aqi)\n            },\n            children: Math.round(userLocationData.aqi)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"aqi-status\",\n            children: getAQIStatus(userLocationData.aqi)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"panel-explanation\",\n          children: \"This is an estimated air quality for your current location, calculated using our real sensor network.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"location-prompt\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Click the location button on the map to see personalized air quality data for your area.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 25\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"map-page\",\n    children: [/*#__PURE__*/_jsxDEV(\"nav\", {\n      className: \"navbar\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"navbar-content\",\n        children: [/*#__PURE__*/_jsxDEV(Link, {\n          to: \"/\",\n          className: \"navbar-brand\",\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: logoImage,\n            alt: \"AQM Logo\",\n            width: isMobileView ? \"32\" : \"40\",\n            height: isMobileView ? \"32\" : \"40\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 263,\n            columnNumber: 25\n          }, this), \"AirAware\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 262,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"nav-right\",\n          children: user ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(Link, {\n              to: \"/dashboard\",\n              className: \"nav-link\",\n              children: \"Dashboard\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 269,\n              columnNumber: 33\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: logout,\n              className: \"logout-btn\",\n              children: \"Logout\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 270,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/login\",\n            className: \"login-btn\",\n            children: \"Login\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 261,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 260,\n      columnNumber: 14\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: `main-content ${isMobileView ? 'mobile-view' : ''}`,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"map-wrapper\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          id: \"map\",\n          ref: mapRef,\n          className: \"map-element\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 280,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: trackUserLocation,\n          className: \"my-location-btn\",\n          disabled: isLocationLoading,\n          children: isLocationLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"spinner\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 46\n          }, this) : 'ð'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 281,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 279,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"data-panel\",\n        children: isLoading ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"panel-loader\",\n          children: \"Loading Stations...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 286,\n          columnNumber: 34\n        }, this) : renderPanelContent()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 278,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 259,\n    columnNumber: 9\n  }, this);\n};\n_s(MapPage, \"7bxr19qu2N0ZbtRV7g2YHbibZ64=\", false, function () {\n  return [useAuth, useNavigate];\n});\n_c = MapPage;\nexport default MapPage;\nvar _c;\n$RefreshReg$(_c, \"MapPage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","useMemo","Link","useNavigate","logoImage","useAuth","jsxDEV","_jsxDEV","Fragment","_Fragment","getAQIColor","aqi","undefined","getAQIStatus","calculateDistance","lat1","lon1","lat2","lon2","R","dLat","Math","PI","dLon","a","sin","cos","c","atan2","sqrt","MapPage","_s","mapInstance","setMapInstance","stations","setStations","selectedStation","setSelectedStation","isLoading","setIsLoading","userLocation","setUserLocation","userLocationData","setUserLocationData","isLocationLoading","setIsLocationLoading","isMobileView","setIsMobileView","window","innerWidth","activeView","setActiveView","mapRef","markersRef","userLocationMarkerRef","user","logout","navigate","API_BASE_URL","process","env","NODE_ENV","handleResize","addEventListener","removeEventListener","current","_leaflet_id","map","L","zoomControl","setView","tileLayer","attribution","addTo","control","zoom","position","calculateSmartEstimation","locationData","allStations","realStationIds","realStations","forEach","id","Object","keys","length","values","totalWeight","weightedValues","pm25","pm10","so2","no2","co","o3","nh3","weightedAqi","station","distance","lat","lng","station_info","weight","max","param","_station$averages","averages","highest_sub_index","estimatedValues","parseFloat","toFixed","estimatedAqi","round","estimation","distanceToNearest","isHighConfidence","quality","fetchData","response","fetch","ok","Error","data","json","err","console","error","interval","setInterval","clearInterval","marker","remove","entries","icon","divIcon","html","className","iconSize","iconAnchor","on","popupContent","name","bindPopup","openPopup","userIcon","setLatLng","trackUserLocation","navigator","geolocation","getCurrentPosition","loc","coords","latitude","longitude","renderPanelContent","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","style","color","key","_data$averages","_data$averages$key","toUpperCase","to","src","alt","width","height","ref","disabled","_c","$RefreshReg$"],"sources":["C:/React/my-django-react-app/frontend/src/components/MapPage.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport logoImage from '../assets/aqi.webp'; \r\nimport { useAuth } from '../App';\r\nimport './css/MapPage.css';\r\n\r\n// --- Helper Functions ---\r\nconst getAQIColor = (aqi) => {\r\n    if (aqi === null || aqi === undefined) return '#9ca3af'; // Gray for unknown/upcoming\r\n    if (aqi <= 50) return '#10b981';\r\n    if (aqi <= 100) return '#f59e0b';\r\n    if (aqi <= 200) return '#ef4444';\r\n    return '#7c2d12';\r\n};\r\n\r\nconst getAQIStatus = (aqi) => {\r\n    if (aqi === null || aqi === undefined) return 'Upcoming';\r\n    if (aqi <= 50) return 'Good';\r\n    if (aqi <= 100) return 'Moderate';\r\n    if (aqi <= 200) return 'Unhealthy';\r\n    return 'Hazardous';\r\n};\r\n\r\nconst calculateDistance = (lat1, lon1, lat2, lon2) => {\r\n    const R = 6371; // km\r\n    const dLat = (lat2 - lat1) * Math.PI / 180;\r\n    const dLon = (lon2 - lon1) * Math.PI / 180;\r\n    const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) ** 2;\r\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n    return R * c;\r\n};\r\n\r\nconst MapPage = () => {\r\n    // --- STATE MANAGEMENT ---\r\n    const [mapInstance, setMapInstance] = useState(null);\r\n    const [stations, setStations] = useState({});\r\n    const [selectedStation, setSelectedStation] = useState(null);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [userLocation, setUserLocation] = useState(null);\r\n    const [userLocationData, setUserLocationData] = useState(null);\r\n    const [isLocationLoading, setIsLocationLoading] = useState(false);\r\n    const [isMobileView, setIsMobileView] = useState(window.innerWidth <= 768);\r\n    const [activeView, setActiveView] = useState('user'); // 'user' or 'station'\r\n\r\n    const mapRef = useRef(null);\r\n    const markersRef = useRef({});\r\n    const userLocationMarkerRef = useRef(null);\r\n\r\n    const { user, logout } = useAuth();\r\n    const navigate = useNavigate();\r\n    const API_BASE_URL = process.env.NODE_ENV === 'production' \r\n        ? 'https://airaware-app-gcw7.onrender.com' \r\n        : 'http://localhost:8000';\r\n\r\n    // --- HOOKS ---\r\n    useEffect(() => {\r\n        if (!user) navigate('/login');\r\n    }, [user, navigate]);\r\n\r\n    useEffect(() => {\r\n        const handleResize = () => setIsMobileView(window.innerWidth <= 768);\r\n        window.addEventListener('resize', handleResize);\r\n        return () => window.removeEventListener('resize', handleResize);\r\n    }, []);\r\n\r\n    // CORRECTED: This effect now safely initializes the map once.\r\n    useEffect(() => {\r\n        if (mapRef.current && !mapRef.current._leaflet_id) {\r\n            const map = window.L.map(mapRef.current, { zoomControl: false }).setView([10.176, 76.430], 13);\r\n            window.L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: 'Â© OpenStreetMap' }).addTo(map);\r\n            window.L.control.zoom({ position: 'topright' }).addTo(map);\r\n            setMapInstance(map);\r\n        }\r\n    }, []); // Empty dependency array ensures this runs only on mount.\r\n\r\n    const calculateSmartEstimation = useCallback((locationData, allStations) => {\r\n        const realStationIds = ['lora-v1', 'loradev2'];\r\n        const realStations = {};\r\n        realStationIds.forEach(id => {\r\n            if (allStations[id]) realStations[id] = allStations[id];\r\n        });\r\n        if (Object.keys(realStations).length === 0) return { aqi: 0, values: {} };\r\n        \r\n        let totalWeight = 0;\r\n        const weightedValues = { pm25: 0, pm10: 0, so2: 0, no2: 0, co: 0, o3: 0, nh3: 0 };\r\n        let weightedAqi = 0;\r\n\r\n        Object.values(realStations).forEach(station => {\r\n            const distance = calculateDistance(locationData.lat, locationData.lng, station.station_info.lat, station.station_info.lng);\r\n            const weight = 1.0 / (Math.max(distance, 0.001) ** 2);\r\n            totalWeight += weight;\r\n            Object.keys(weightedValues).forEach(param => {\r\n                if (station.averages?.[param] !== undefined) weightedValues[param] += station.averages[param] * weight;\r\n            });\r\n            weightedAqi += (station.highest_sub_index || 0) * weight;\r\n        });\r\n\r\n        const estimatedValues = {};\r\n        Object.keys(weightedValues).forEach(param => {\r\n            estimatedValues[param] = totalWeight > 0 ? parseFloat((weightedValues[param] / totalWeight).toFixed(2)) : 0;\r\n        });\r\n        const estimatedAqi = totalWeight > 0 ? Math.round(weightedAqi / totalWeight) : 50;\r\n        return { values: estimatedValues, aqi: estimatedAqi };\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (userLocation && Object.keys(stations).length > 0) {\r\n            const estimation = calculateSmartEstimation(userLocation, stations);\r\n            const { lat, lng } = stations['lora-v1'].station_info;\r\n            const distanceToNearest = calculateDistance(userLocation.lat, userLocation.lng, lat, lng);\r\n            const isHighConfidence = distanceToNearest <= 5.0;\r\n\r\n            setUserLocationData({\r\n                aqi: estimation.aqi,\r\n                values: estimation.values,\r\n                quality: isHighConfidence ? 'High-Accuracy' : 'Regional Estimation'\r\n            });\r\n        }\r\n    }, [userLocation, stations, calculateSmartEstimation]);\r\n\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            setIsLoading(true);\r\n            try {\r\n                const response = await fetch(`${API_BASE_URL}/api/map/realtime/`);\r\n                if (!response.ok) throw new Error('Network response was not ok');\r\n                const data = await response.json();\r\n                setStations(data.stations);\r\n            } catch (err) {\r\n                console.error(\"Failed to fetch station data:\", err);\r\n            } finally {\r\n                setIsLoading(false);\r\n            }\r\n        };\r\n        fetchData();\r\n        const interval = setInterval(fetchData, 60000);\r\n        return () => clearInterval(interval);\r\n    }, [API_BASE_URL]);\r\n    \r\n    useEffect(() => {\r\n        if (mapInstance && Object.keys(stations).length > 0) {\r\n            Object.values(markersRef.current).forEach(marker => marker.remove());\r\n            markersRef.current = {};\r\n            \r\n            Object.entries(stations).forEach(([id, station]) => {\r\n                const { lat, lng } = station.station_info;\r\n                const aqi = station.highest_sub_index;\r\n                const icon = window.L.divIcon({\r\n                    html: `<div class=\"station-marker-icon\" style=\"background-color: ${getAQIColor(aqi)};\"></div>`,\r\n                    className: 'station-marker', iconSize: [24, 24], iconAnchor: [12, 12]\r\n                });\r\n                const marker = window.L.marker([lat, lng], { icon }).addTo(mapInstance);\r\n                \r\n                marker.on('click', () => {\r\n                    if (station.averages) {\r\n                        setSelectedStation(station);\r\n                        setActiveView('station');\r\n                    } else {\r\n                        const popupContent = `\r\n                            <div class=\"upcoming-popup\">\r\n                                <h4>${station.station_info.name}</h4>\r\n                                <p>This station is coming soon.</p>\r\n                                <span>Data Update Soon...</span>\r\n                            </div>\r\n                        `;\r\n                        marker.bindPopup(popupContent).openPopup();\r\n                    }\r\n                });\r\n                markersRef.current[id] = marker;\r\n            });\r\n        }\r\n    }, [mapInstance, stations]);\r\n    \r\n    useEffect(() => {\r\n        if (mapInstance && userLocation) {\r\n            const userIcon = window.L.divIcon({\r\n                html: `<div class=\"user-location-marker\"></div>`,\r\n                className: 'user-marker', iconSize: [24, 24], iconAnchor: [12, 12]\r\n            });\r\n            if (userLocationMarkerRef.current) {\r\n                userLocationMarkerRef.current.setLatLng(userLocation);\r\n            } else {\r\n                userLocationMarkerRef.current = window.L.marker(userLocation, { icon: userIcon }).addTo(mapInstance);\r\n            }\r\n        }\r\n    }, [mapInstance, userLocation]);\r\n\r\n    const trackUserLocation = useCallback(() => {\r\n        setIsLocationLoading(true);\r\n        setActiveView('user');\r\n        navigator.geolocation.getCurrentPosition(\r\n            (position) => {\r\n                const loc = { lat: position.coords.latitude, lng: position.coords.longitude };\r\n                setUserLocation(loc);\r\n                setIsLocationLoading(false);\r\n                if (mapInstance) mapInstance.setView(loc, 15);\r\n            },\r\n            () => {\r\n                setIsLocationLoading(false);\r\n            }\r\n        );\r\n    }, [mapInstance]);\r\n    \r\n    const renderPanelContent = () => {\r\n        if (activeView === 'station' && selectedStation) {\r\n            const data = selectedStation;\r\n            return (\r\n                <>\r\n                    <div className=\"panel-header\">\r\n                        <h3>{data.station_info.name}</h3>\r\n                        <button className=\"back-btn\" onClick={() => setActiveView('user')}>â Back to Your Location</button>\r\n                    </div>\r\n                    <div className=\"aqi-display\">\r\n                        <div className=\"aqi-value\" style={{ color: getAQIColor(data.highest_sub_index) }}>\r\n                            {Math.round(data.highest_sub_index)}\r\n                        </div>\r\n                        <div className=\"aqi-status\">{getAQIStatus(data.highest_sub_index)}</div>\r\n                    </div>\r\n                    <div className=\"readings-grid\">\r\n                        {['pm25', 'pm10', 'no2', 'so2', 'o3', 'co'].map(key => (\r\n                             <div key={key} className=\"reading-item\">\r\n                                <span className=\"reading-label\">{key.toUpperCase()}</span>\r\n                                <span className=\"reading-value\">{data.averages?.[key]?.toFixed(1) || 'N/A'}</span>\r\n                             </div>\r\n                        ))}\r\n                    </div>\r\n                </>\r\n            );\r\n        }\r\n\r\n        return (\r\n            <>\r\n                <div className=\"panel-header\">\r\n                    <h3>Your Location's Air Quality</h3>\r\n                </div>\r\n                {userLocationData ? (\r\n                    <>\r\n                        <div className=\"aqi-display\">\r\n                            <div className=\"aqi-quality-badge\">{userLocationData.quality}</div>\r\n                            <div className=\"aqi-value\" style={{ color: getAQIColor(userLocationData.aqi) }}>\r\n                                {Math.round(userLocationData.aqi)}\r\n                            </div>\r\n                            <div className=\"aqi-status\">{getAQIStatus(userLocationData.aqi)}</div>\r\n                        </div>\r\n                        <p className=\"panel-explanation\">\r\n                            This is an estimated air quality for your current location, calculated using our real sensor network.\r\n                        </p>\r\n                    </>\r\n                ) : (\r\n                    <div className=\"location-prompt\">\r\n                        <p>Click the location button on the map to see personalized air quality data for your area.</p>\r\n                    </div>\r\n                )}\r\n            </>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"map-page\">\r\n             <nav className=\"navbar\">\r\n                <div className=\"navbar-content\">\r\n                    <Link to=\"/\" className=\"navbar-brand\">\r\n                        <img src={logoImage} alt=\"AQM Logo\" width={isMobileView ? \"32\" : \"40\"} height={isMobileView ? \"32\" : \"40\"} />\r\n                        AirAware\r\n                    </Link>\r\n                    <div className=\"nav-right\">\r\n                        {user ? (\r\n                            <>\r\n                                <Link to=\"/dashboard\" className=\"nav-link\">Dashboard</Link>\r\n                                <button onClick={logout} className=\"logout-btn\">Logout</button>\r\n                            </>\r\n                        ) : (\r\n                            <Link to=\"/login\" className=\"login-btn\">Login</Link>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n            </nav>\r\n            <div className={`main-content ${isMobileView ? 'mobile-view' : ''}`}>\r\n                <div className=\"map-wrapper\">\r\n                    <div id=\"map\" ref={mapRef} className=\"map-element\"></div>\r\n                    <button onClick={trackUserLocation} className=\"my-location-btn\" disabled={isLocationLoading}>\r\n                        {isLocationLoading ? <div className=\"spinner\"></div> : 'ð'}\r\n                    </button>\r\n                </div>\r\n                <div className=\"data-panel\">\r\n                    {isLoading ? <div className=\"panel-loader\">Loading Stations...</div> : renderPanelContent()}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MapPage;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}